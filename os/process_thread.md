## 프로세스와 쓰레드

- 프로세스: 운영체제로부터 자원을 할당받은 작업의 단위.
- 스레드: 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위.

### 프로그램 --> 프로세스

> 프로그램이란, 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않은 정적인 상태를 말함.

- 메모리에 올라가 있지 않은: 아직 운영체제가 프로그램에게 독립적인 메모리 공간을 할당해주지 않았다는 뜻.
- 정적인 상태 : 움직이지 않는 상태. 한 마디로 아직 실행되지 않고 가만히 있다는 뜻.

> 프로그램이라는 단어는 아직 실행되지 않은 파일 그 자체를 가리키는 말

프로그램 실행 시

- 해당 파일은 컴퓨터 메모리에 올라감.
    - 이 상태를 동적인 상태라고 하며 이 상태의 프로그램을 "프로세스" 라고 함.

<img src="/os/os_img/program.png" />

### 프로세스 --> 쓰레드

- 과거에는 프로그램을 실행할 때 실행 시작부터 실행 끝까지 프로세스 하나만을 사용해서 진행.
- 하지만 시간이 흐를수록 프로그램이 복잡해지고 프로세스 하나만을 사용해서 프로그램을 실행하기는 벅차게 됨.
    - 이제는 프로그램 하나가 단순히 한 가지 작업만을 하는 경우는 없음.
- 쉽게 떠오르는 방법은, "한 프로그램을 처리하기 위한 프로세스를 여러 개 만들면 되지 않을까?" 생각이 들지만 이는 불가능한 일.
    - 왜냐하면 운영체제는 안전성을 위해서 프로세스마다 자신에게 할당된 메모리 내의 정보에만 접근할 수 있도록 제약을 두고 있고, 이를 벗어나는 정보에 접근하려면 오류가 발생하기 때문.

- 그러므로 프로세스와는 다른 더 작은 실행 단위 개념이 필요하게 되었고, 이 개념이 바로 스레드다.

> 쓰레드는 프로세스의 코드에 정의된 절차에 따라 실행되는 특정한 수행 경로

### 프로세스와 스레드의 작동 방식에 대한 더 자세한 설명
 - 프로세스가 메모리에 올라갈 때 운영체제로부터 시스템 자원을 할당받음.
 - 이 때 운영체제는 프로세스마다 각각 독립된 메모리 영역을, Code/Data/Stack/Heap 의 형식으로 할당해 줌.
   - 독립된 메모리 영역을 할당해 주기 때문에 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없음.

<img src="/os/os_img/process.png" />

 - 이와 다르게 스레드는 메모리를 서로 공유할 수 있다고 언급했었다.
   - 프로세스가 할당받은 메모리 영역 내에서 Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 나머지 Code/Data/Heap 형식으로 할당된 메모리 영역을 공유한다.
   - 따라서 각각의 쓰레드는 별도의 스택을 가지고 있지만 힙 메모리는 서로 읽고 쓸 수 있게 된다.

<img src="/os/os_img/thread.png" />

 - 만약 한 프로세스를 실행하다가 오류가 발생해서 프로세스가 강제로 종료된다면?
   - 다른 프로세스에 영향을 주지 않음. 단 공유하고 잇는 파일을 손상시키는 경우가 아니라면
 - 쓰레드는 Code/Data/Heap 메모리 영역의 내용을 공유하기 때문에 어떤 쓰레드 하나에서 오류가 발생한다면 같은 프로세스 내의 다른 쓰레드 모두가 강제로 종료됨.

 - 쓰레드는 CPU 입장에서 최소 작업 단위.
 - 반면 운영체제는 이렇게 작은 단위까지 직접 작업하지 않기 때문에 운영체제 관점에서는 프로세스가 최소 작업 단위가 됨.
 - 하나의 프로세스는 하나 이상의 쓰레드를 가짐. 따라서 운영체제 관점에서는 프로세스가 최소 작업 단위인데, 이 때문에 같은 프로세스 소속의 쓰레드끼리 메모리를 공유하지 않을 수 없음.


### 멀티태스킹, 멀티쓰레드
 - 멀티태스킹이 하나의 운영 체제 안에서 여러 프로세스가 실행되는 것이라면, 멀티스레드는 하나의 프로세스가 여러 작업을 여러 스레드를 사용하여 동시에 처리하는 것을 의미.

>멀티스레드의 장점
> - Context-Switching할 때 공유하고 있는 메모리만큼의 메모리 자원을 아낄 수 있다.
> - 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적어서 응답 시간이 빠르다.

> 멀티스레드의 단점
> - 스레드 하나가 프로세스 내 자원을 망쳐버린다면 모든 프로세스가 종료될 수 있다.
> - 자원을 공유하기 때문에 필연적으로 동기화 문제가 발생할 수밖에 없다.
>

장단점에서 꼭 짚고 넘어가야 할 점이 바로 동기화 문제..
 - 주로 Synchronization Issue 라고 함.
 - 멀티쓰레드를 사용하면 각각의 쓰레드 중 어떤 것이 어떤 순서로 실행될 지 그 순서를 알 수 없음.
 - 만약 A 쓰레드가 어떤 자원을 사용하다가 B 쓰레드로 제어권이 넘어간 후 B 쓰레드가 해당자원을 수정했을 때, 다시 제어권을 받은 A 쓰레드가 해당 자원에 접근하지 못하거나 바뀐 자원에 접근하게 되는 오류가 발생할 수 있음.
   - 이처럼 여러 쓰레드가 함께 전역변수를 사용할 경우 발생할 수 있는 충돌을 동기화 문제라고 함.

> 운영체제가 프로세스에게 Code/Data/Stack/Heap 메모리 영역을 할당해 주고 최소 작업 단위로 삼는 반면,
> 스레드는 프로세스 내에서 Stack 메모리 영역을 제외한 다른 메모리 영역을 같은 프로세스 내 다른 스레드와 공유한다.


출처 : https://velog.io/@raejoonee/%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4%EC%99%80-%EC%8A%A4%EB%A0%88%EB%93%9C%EC%9D%98-%EC%B0%A8%EC%9D%B4